#!/bin/bash

if ! [ "$(which acpi)" ]; then
	exit
fi

battery="$(find /sys/class/power_supply/BAT[0-9]*)"
if ! [ -x $battery ] ; then
	exit
fi

state=$([[ $(cat "$battery/status") == "Discharging" ]] \
	&& echo '-' \
	|| echo '+')

battery_charge=$(acpi -b 2> /dev/null | grep -o "[0-9]*%")
val="${battery_charge%?}"
if   [ "$val"  -lt "20"  ] ; then color='#[fg=red]'
elif [ "$val"  -lt "40"  ] ; then color='#[fg=orange]'
elif [ "$val"  -lt "60"  ] ; then color='#[fg=brightyellow]'
elif [ "$val"  -lt "80"  ] ; then color='#[fg=brightgreen]'
elif [ "$val"  -lt "100" ] ; then color='#[fg=blue]'
elif [ "$state" == '-'   ] ; then color='#[fg=blue]'
elif [ "$state" == '+'   ] ; then color='#[fg=grey]'
fi

default='#[default]'
printf "%s" "${color}${state}${battery_charge}${default}"
